# private source codes

## Setting
```{r, eval=FALSE}
wd = "/Users/ikegami/MicroSEC"
knitr::opts_chunk$set(collapse = TRUE, fig.width=12, fig.height=8, echo=TRUE, warning=FALSE, message=TRUE, comment = "#>")
knitr::opts_knit$set(root.dir = wd)
options(rmarkdown.html_vignette.check_title = FALSE)
fun_zero <- function(a, b)ifelse(b == 0, 0, a / b)
setwd(wd)
```

## Necessary packages
```{r packages, eval=FALSE}
library(tidyr)
library(openxlsx)
library(data.table)
library(R.utils)
library(stringr)
library(magrittr)
library(dplyr)
library(Biostrings)
library(BSgenome.Hsapiens.UCSC.hg38)
library(GenomicAlignments)
library(Rsamtools)
library(tcltk)
library(gtools)
library(MicroSEC)
library(tidyverse)
library(ggplot2)
library(ggsci)
library(epiR)
```

## data division
```{r}
SAMPLE_LIST = "source/201115_sample_correspondence_sheet_V3.xlsx"
df_sample_list = read.xlsx(SAMPLE_LIST, sheet = 1)
READ_SUMMARY = "source/SL_read_summary_201219.xlsx"
READ_SUMMARY_TOP = "source/TOP_RS.xlsx"
df_read_summary = read.xlsx(READ_SUMMARY, sheet = 1)[,1:16]
df_read_summary_TOP = read.xlsx(READ_SUMMARY_TOP, sheet = 1)[,1:16]
#info_1 = "/mnt/HDD8TB/MicroSEC/source/SL_mutation_somatic_200820.xlsx"
#info_5 = "/mnt/HDD8TB/MicroSEC/source/SL_mutation_somatic_201130.xlsx"
#info_match = "/mnt/HDD8TB/MicroSEC/source/SL_mutation_somatic_200907.xlsx"
#info_TOP = "/mnt/HDD8TB/MicroSEC/source/TOP_validation.xlsx"
df_sample_list = df_sample_list %>% dplyr::filter(Frozen.or.FFPE.or.Blood != "Blood")
df_sample_list = df_sample_list %>% dplyr::filter(!is.na(Tumor.or.Normal))
df_sample_list = df_sample_list %>% dplyr::filter(TOP.or.WES == "TOP")
df_sample_list = df_sample_list %>% dplyr::filter(!`Sample.(n=389).(SL0005_RN1.not.excluded)` %in% c("SL_0005-RN-1_TDv4(exclude)", "SL_1010-N3_TDv4"))
df_sample_list = df_sample_list %>% dplyr::mutate(Sample = paste(str_sub(`Sample.(n=389).(SL0005_RN1.not.excluded)`, 1, -6), "-B", sep=""))
df_QC = df_read_summary %>% dplyr::filter(Mean_coverage >= 400)
df_sample_list = df_sample_list %>% dplyr::filter(`Sample.(n=389).(SL0005_RN1.not.excluded)` %in% df_QC$Sample)
df_read_summary_TOP$Sample = paste(str_sub(df_read_summary_TOP$Sample, 1, -6), "-N", sep="")
df_QC_TOP = df_read_summary_TOP %>% dplyr::filter(Mean_coverage >= 400)
df_frozen_normal = df_sample_list %>% dplyr::filter(Frozen.or.FFPE.or.Blood == "Frozen" & (Tumor.or.Normal == "Normal(true)" | Tumor.or.Normal == "Normal(susp)"))
df_FFPE_normal = df_sample_list %>% dplyr::filter(Frozen.or.FFPE.or.Blood == "FFPE" & (Tumor.or.Normal == "Normal(true)" | Tumor.or.Normal == "Normal(susp)"))
df_frozen_tumor = df_sample_list %>% dplyr::filter(Frozen.or.FFPE.or.Blood == "Frozen" & (Tumor.or.Normal == "Tumor" | Tumor.or.Normal == "Tumor(surrounding)" | Tumor.or.Normal == "Tumor(non_pathogenic)"))
df_FFPE_tumor = df_sample_list %>% dplyr::filter(Frozen.or.FFPE.or.Blood == "FFPE" & (Tumor.or.Normal == "Tumor" | Tumor.or.Normal == "Tumor(surrounding)" | Tumor.or.Normal == "Tumor(non_pathogenic)"))
```

# don't run
```{r}
MUTATION_LIST_1 = "/mnt/HDD8TB/MicroSEC/source/summary_1112.tsv"
MUTATION_LIST_2 = "/mnt/HDD8TB/MicroSEC/source/summary_1114.tsv"
MUTATION_LIST_3 = "/mnt/HDD8TB/MicroSEC/source/summary_0102.tsv"
MUTATION_LIST_5 = "/mnt/HDD8TB/MicroSEC/source/summary_1201.tsv"
MUTATION_LIST_match = "/mnt/HDD8TB/MicroSEC/source/summary_1217.tsv"
MUTATION_LIST_TOP = "/mnt/HDD8TB/MicroSEC/source/summary_TOP.tsv"
df_mutation_1 =  read.csv(MUTATION_LIST_1, stringsAsFactors=FALSE, header=TRUE, check.names=F, sep="\t")
df_mutation_2 =  read.csv(MUTATION_LIST_2, stringsAsFactors=FALSE, header=TRUE, check.names=F, sep="\t")
df_mutation_3 =  read.csv(MUTATION_LIST_3, stringsAsFactors=FALSE, header=TRUE, check.names=F, sep="\t")
df_mutation_5 =  read.csv(MUTATION_LIST_5, stringsAsFactors=FALSE, header=TRUE, check.names=F, sep="\t")
df_mutation_match =  read.csv(MUTATION_LIST_match, stringsAsFactors=FALSE, header=TRUE, check.names=F, sep="\t")
df_mutation_TOP =  read.csv(MUTATION_LIST_TOP, stringsAsFactors=FALSE, header=TRUE, check.names=F, sep="\t")
```

# analysis
```{r}

isNumeric <- function(st) {
  return(!is.na(suppressWarnings(as.numeric(st))))
}

#df_mutation = rbind(df_mutation_1, df_mutation_2, df_mutation_3, df_mutation_5, df_mutation_match) %>% dplyr::distinct()
#df_mutation = rbind(df_mutation_1, df_mutation_5, df_mutation_match) %>% dplyr::distinct()
#MUTATION_LIST = "/Users/ikegami/Desktop/FFPE/MicroSEC/SL_revise.xlsx"
#MUTATION_LIST_TOP = "/Users/ikegami/Desktop/FFPE/MicroSEC/TOP_revise.xlsx"
MUTATION_LIST = "source/supplementary_data_revise.xlsx"
MUTATION_LIST_TOP = "source/supplementary_data_revise.xlsx"
SOBD_LIST = "source/SOBDetector_df_210511.xlsx"
df_mutation = read.xlsx(MUTATION_LIST, sheet = 1)
df_mutation_TOP = read.xlsx(MUTATION_LIST_TOP, sheet = 1)
df_SOBD = rbind(read.xlsx(SOBD_LIST, sheet = 1), read.xlsx(SOBD_LIST, sheet = 2))
df_SOBD$artiStatus[is.na(df_SOBD$artiStatus)] <- "NA"
df_mutation[is.na(df_mutation)] <- FALSE
df_mutation_TOP[is.na(df_mutation_TOP)] <- FALSE
df_mutation <- dplyr::mutate_all(df_mutation, ~gsub(.,pattern="Artifact suspicious",replacement = TRUE))
df_mutation_TOP <- dplyr::mutate_all(df_mutation_TOP, ~gsub(.,pattern="Artifact suspicious",replacement = TRUE))
for (i in 1:dim(df_mutation)[2]) {
  if (isNumeric(df_mutation[1,i])){
    df_mutation[,i] <- as.numeric(df_mutation[,i])
  }
  if (df_mutation[1,i] %in% c("TRUE", "FALSE")){
    df_mutation[,i] <- as.logical(df_mutation[,i])
  }
}

for (i in 1:dim(df_mutation_TOP)[2]) {
  if (isNumeric(df_mutation_TOP[1,i])){
    df_mutation_TOP[,i] <- as.numeric(df_mutation_TOP[,i])
  }
  if (df_mutation_TOP[1,i] %in% c("TRUE", "FALSE")){
    df_mutation_TOP[,i] <- as.logical(df_mutation_TOP[,i])
  }
}

df_mutation = df_mutation %>% dplyr::mutate(Transition =
            ifelse(Mut_type == "1-snv" & (str_sub(Neighborhood_sequence, 21, 22) == "TG" & Ref == "C") | (str_sub(Neighborhood_sequence, 20, 21) == "CA" & Ref == "G"), "C>T_g", Transition))
df_mutation_TOP = df_mutation_TOP %>% dplyr::mutate(Transition =
            ifelse(Mut_type == "1-snv" & (str_sub(Neighborhood_sequence, 21, 22) == "TG" & Ref == "C") | (str_sub(Neighborhood_sequence, 20, 21) == "CA" & Ref == "G"), "C>T_g", Transition))
df_mutation = df_mutation %>% dplyr::mutate(filter_6_c_to_t_artifact =
            ifelse(Transition == "C>T_g", TRUE, FALSE))
df_mutation_TOP = df_mutation_TOP %>% dplyr::mutate(filter_6_c_to_t_artifact =
            ifelse(Transition == "C>T_g", TRUE, FALSE))
matched_FFPE = c("SL_0004_L_FFPE_TUMOR-B", "SL_0005_L_FFPE_TUMOR-B", "SL_0007_L_FFPE_TUMOR-B", "SL_0008_L_FFPE_TUMOR-B", "SL_0009_L_FFPE_TUMOR-B", "SL_0011_R_FFPE_TUMOR-B", "SL_0012_R_FFPE_TUMOR-B", "SL_0013_R_FFPE_TUMOR-B")
matched_frozen = c("SL_0004-LT-8-B",  "SL_0005-LT-4-B", "SL_0007_LT_3-B", "SL_0008_LT_8-B", "SL_0009-LT_3-B", "SL_0011-LT_2-B", "SL_0012_RT_4-B", "SL_0013_RT_4-B")
Homo_length = 10
df_mutation = df_mutation %>% dplyr::mutate(Homopolymer =
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("C", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("C", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("C", Homo_length)) > 0)
df_mutation_TOP = df_mutation_TOP %>% dplyr::mutate(Homopolymer =
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("C", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("C", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("C", Homo_length)) > 0)
df_filter = df_mutation %>% dplyr::filter(filter_7_mutation_at_homopolymer == FALSE & !filter_8_low_quality)
df_TOP = df_mutation_TOP %>% dplyr::filter(filter_7_mutation_at_homopolymer == FALSE & !filter_8_low_quality)
df_filter = df_filter %>% dplyr::filter(`%Alt` >= 5) %>% dplyr::filter(Sample %in% c(df_frozen_normal$Sample, df_FFPE_normal$Sample, df_frozen_tumor$Sample, df_FFPE_tumor$Sample))
df_TOP = df_TOP %>% dplyr::filter(`%Alt` >= 5)
df_TOP = df_TOP %>% dplyr::filter(Sample %in% df_QC_TOP$Sample)
df_filter = df_filter %>% dplyr::filter(SimpleRepeat_TRF == "N")
df_TOP = df_TOP %>% dplyr::filter(SimpleRepeat_TRF == "N")
df_filter_5 = df_filter %>% dplyr::filter(total_read >= 5)
df_filter = df_filter %>% dplyr::filter(total_read >= 10)
df_TOP = df_TOP %>% dplyr::filter(total_read >= 10)

df_filter$artiStatus = "NA"
for (i in 1:length(df_filter$artiStatus)) {
  j = df_SOBD[df_SOBD$Sample == df_filter[i,"Sample"] & df_SOBD$Chr == df_filter[i,"Chr"] & df_SOBD$Pos == df_filter[i,"Pos"],"artiStatus"]
  if (length(j) ==1) {
    df_filter[i,"artiStatus"] = j
  }
}

df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample)
df_filter_TOP = df_TOP
df_matched = NULL
for (i in 1:length(matched_FFPE)){
  df_matched = rbind(df_matched, dplyr::inner_join(df_filter_FFPE_tumor %>% dplyr::filter(Sample %in% matched_FFPE[i]),
                                       df_filter_frozen_tumor %>% dplyr::filter(Sample %in% matched_frozen[i]),
                                       by=c("Chr", "Pos", "Ref", "Alt")))
}
data_matched = data.frame("Number" = "Total_mutations",
                          "FF_only" = dim(df_filter_frozen_tumor %>% dplyr::filter(Sample %in% matched_frozen))[1] - dim(df_matched)[1],
                          "FF_and_FFPE"= dim(df_matched)[1],
                          "FFPE_only" = dim(df_filter_FFPE_tumor %>% dplyr::filter(Sample %in% matched_FFPE))[1] - dim(df_matched)[1])
data_mutations = data.frame("Number" = "ALL_samples_No_filter",
                          "FF_N_sample" = 53,
                          "FFPE_N_sample" = 190,
                          "FF_T_sample" = 23,
                          "FFPE_T_sample" = 33,
                          "FFPE_TOP_sample"= 54,
                          "FF_N_min" = min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)),
                          "FFPE_N_min" = min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)),
                          "FF_T_min" = min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)),
                          "FFPE_T_min" = min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)),
                          "FFPE_TOP_min"= min(sort(rle(sort(df_filter_TOP$Sample))$lengths)),
                          "FF_N_max" = max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)),
                          "FFPE_N_max" = max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)),
                          "FF_T_max" = max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)),
                          "FFPE_T_max" = max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)),
                          "FFPE_TOP_max"= max(sort(rle(sort(df_filter_TOP$Sample))$lengths)),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1],
                          "FFPE_N_median" = mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])),
                          "FF_T_median" = (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1],
                          "FFPE_T_median" = (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1],
                          "FFPE_TOP_median"= mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1]))
                          )
utils::write.table(df_filter_frozen_normal, "output/df_filter_frozen_normal.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)
utils::write.table(df_filter_FFPE_normal, "output/df_filter_FFPE_normal.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)
utils::write.table(df_filter_frozen_tumor, "output/df_filter_frozen_tumor.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)
utils::write.table(df_filter_FFPE_tumor, "output/df_filter_FFPE_tumor.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)
utils::write.table(df_filter_TOP, "output/df_filter_TOP.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)
```

## p-value
```{r}
sampling = c(
"Total",
"400_1",
"400_2",
"400_3",
"300_1",
"300_2",
"300_3",
"200_1",
"200_2",
"200_3",
"100_1",
"100_2",
"100_3",
"50_1",
"50_2",
"50_3",
"30_1",
"30_2",
"30_3")

p_value = NULL
for (i in sampling) {
  file = paste("source/MicroSEC/smp_", i, "/MicroSEC_SL_0002-RN-5-B.tsv", sep = "")
  df_p = read.csv(file, stringsAsFactors=FALSE, header=TRUE, check.names=F, sep="\t")
  df_p[is.na(df_p)] <- FALSE
  df_p <- dplyr::mutate_all(df_p, ~gsub(.,pattern="Artifact suspicious",replacement = TRUE))
  for (i in 1:dim(df_p)[2]) {
    if (isNumeric(df_p[1,i])){
      df_p[,i] <- as.numeric(df_p[,i])
    }
    if (df_p[1,i] %in% c("TRUE", "FALSE")){
      df_p[,i] <- as.logical(df_p[,i])
    }
  }

  df_p = df_p %>% dplyr::mutate(Transition =
              ifelse(Mut_type == "1-snv" & (str_sub(Neighborhood_sequence, 21, 22) == "TG" & Ref == "C") |
                      (str_sub(Neighborhood_sequence, 20, 21) == "CA" & Ref == "G"), "C>T_g", Transition))
  df_p = df_p %>% dplyr::mutate(filter_6_c_to_t_artifact =
              ifelse(Transition == "C>T_g", TRUE, FALSE))
  Homo_length = 10
  df_p = df_p %>% dplyr::mutate(Homopolymer =
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("C", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("C", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("C", Homo_length)) > 0)
  #df_p = df_p %>% dplyr::filter(total_read >= 10)
  df_p = df_p %>% dplyr::filter(SimpleRepeat_TRF == "N")
  df_p = df_p %>% dplyr::filter(filter_7_mutation_at_homopolymer == FALSE & !filter_8_low_quality)
  df_p = df_p %>% dplyr::filter(`%Alt` >= 5)
  #df_p = df_p %>% dplyr::filter(Sample %in% df_frozen_normal$Sample)
  df_p = df_p %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample)
  #df_p = df_p %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample)
  #df_p = df_p %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample)

  tmp = NULL
  for (j in 2:9){
    pp = 10^-j
    tmp = c(tmp,
            sum(((df_p$short_pre_support & df_p$short_pre_support_sum & df_p$prob_filter_3_pre < pp) |
            (df_p$short_post_support & df_p$short_post_support_sum & df_p$prob_filter_3_post < pp) |
            (df_p$short_pre_support & df_p$short_pre_support_sum & df_p$prob_filter_1 < pp) |
            df_p$filter_2_hairpin_structure |
            df_p$filter_4_highly_homologous_region) &
            df_p$total_read > 0)
    )
  }
  p_value = rbind(p_value, tmp)
}
rownames(p_value) = sampling
colnames(p_value) = c(
"p_2",
"p_3",
"p_4",
"p_5",
"p_6",
"p_7",
"p_8",
"p_9"
)

utils::write.table(p_value, "output/data_p_sampling_normal_FFPE_result.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)

```


## coverage
```{r}
df_anal = df_filter_FFPE_normal
#df_anal = df_filter_frozen_tumor

df_coverage = data.frame(
"Name" = c(
"total_read",
"400-1",
"400-2",
"400-3",
"300-1",
"300-2",
"300-3",
"200-1",
"200-2",
"200-3",
"100-1",
"100-2",
"100-3",
"50-1",
"50-2",
"50-3",
"30-1",
"30-2",
"30-3"),

"group" = c(
928,
400,
400,
400,
300,
300,
300,
200,
200,
200,
100,
100,
100,
50,
50,
50,
30,
30,
30),


"coverage" = c(
sum(df_anal$`total_read` > 0),
sum(df_anal$`400-1` > 0),
sum(df_anal$`400-2` > 0),
sum(df_anal$`400-3` > 0),
sum(df_anal$`300-1` > 0),
sum(df_anal$`300-2` > 0),
sum(df_anal$`300-3` > 0),
sum(df_anal$`200-1` > 0),
sum(df_anal$`200-2` > 0),
sum(df_anal$`200-3` > 0),
sum(df_anal$`100-1` > 0),
sum(df_anal$`100-2` > 0),
sum(df_anal$`100-3` > 0),
sum(df_anal$`50-1` > 0),
sum(df_anal$`50-2` > 0),
sum(df_anal$`50-3` > 0),
sum(df_anal$`30-1` > 0),
sum(df_anal$`30-2` > 0),
sum(df_anal$`30-3` > 0))
)
rownames(df_coverage) = sampling
df_coverage = cbind(df_coverage, p_value)
df_coverage$percent2 = df_coverage$p_2 / df_coverage$coverage * 100
df_coverage$percent3 = df_coverage$p_3 / df_coverage$coverage * 100
df_coverage$percent4 = df_coverage$p_4 / df_coverage$coverage * 100
df_coverage$percent5 = df_coverage$p_5 / df_coverage$coverage * 100
df_coverage$percent6 = df_coverage$p_6 / df_coverage$coverage * 100
df_coverage$percent7 = df_coverage$p_7 / df_coverage$coverage * 100
df_coverage$percent8 = df_coverage$p_8 / df_coverage$coverage * 100
df_coverage$percent9 = df_coverage$p_9 / df_coverage$coverage * 100

utils::write.table(df_coverage, "output/data_coverage_normal_FFPE_result.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)

df_coverage$percent2 = df_coverage$p_2 / df_coverage$coverage * 3000
df_coverage$percent3 = df_coverage$p_3 / df_coverage$coverage * 3000
df_coverage$percent4 = df_coverage$p_4 / df_coverage$coverage * 3000
df_coverage$percent5 = df_coverage$p_5 / df_coverage$coverage * 3000
df_coverage$percent6 = df_coverage$p_6 / df_coverage$coverage * 3000
df_coverage$percent7 = df_coverage$p_7 / df_coverage$coverage * 3000
df_coverage$percent8 = df_coverage$p_8 / df_coverage$coverage * 3000
df_coverage$percent9 = df_coverage$p_9 / df_coverage$coverage * 3000

g = ggplot() +
  xlab("Coverage")+ ylab("Called mutations")+ 
  ggtitle("Coverage and filtering rate of frozen breast tumor") + 
  scale_x_continuous(breaks=c(0, 30, 50, 100, 200, 300, 400, 1000), limits=c(0,1000)) +
  scale_y_continuous(breaks=seq(0,3000,length=6),limits=c(0,3000), sec.axis = sec_axis(~ . / 30, breaks = seq(0,100,length=6), name = "Filtering rate (%)")) +
  theme_set(theme_bw(base_size = 10)) +
  theme(panel.grid.minor = element_line(colour = "black", size = 0, linetype="blank")) +
  scale_colour_brewer(palette = "Paired") +
  scale_fill_manual(values = "#333333") +
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=coverage, fill = "Mutation count"), 
    geom="bar", 
    stat="identity",
    position="identity"
  )+
  layer(
    data=aggregate(percent2~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent2, color = "p ≤ 10-2"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent2, color = "p ≤ 10-2"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=aggregate(percent3~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent3, color = "p ≤ 10-3"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent3, color = "p ≤ 10-3"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent4~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent4, color = "p ≤ 10-4"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent4, color = "p ≤ 10-4"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent5~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent5, color = "p ≤ 10-5"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent5, color = "p ≤ 10-5"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent6~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent6, color = "p ≤ 10-6"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent6, color = "p ≤ 10-6"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent7~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent7, color = "p ≤ 10-7"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent7, color = "p ≤ 10-7"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent8~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent8, color = "p ≤ 10-8"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent8, color = "p ≤ 10-8"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent9~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent9, color = "p ≤ 10-9"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent9, color = "p ≤ 10-9"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )
ggsave(paste(wd, "/output/coverage_normal_FFPE", Sys.Date(), ".pdf", sep=""), plot=g, width=12, height=8)

```

## p-value
```{r}
sampling = c(
"Total",
"400_1",
"400_2",
"400_3",
"300_1",
"300_2",
"300_3",
"200_1",
"200_2",
"200_3",
"100_1",
"100_2",
"100_3",
"50_1",
"50_2",
"50_3",
"30_1",
"30_2",
"30_3")

p_value = NULL
for (i in sampling) {
  file = paste("source/MicroSEC/smp_", i, "/MicroSEC_SL_0002-RN-5-B.tsv", sep = "")
  df_p = read.csv(file, stringsAsFactors=FALSE, header=TRUE, check.names=F, sep="\t")
  df_p[is.na(df_p)] <- FALSE
  df_p <- dplyr::mutate_all(df_p, ~gsub(.,pattern="Artifact suspicious",replacement = TRUE))
  for (i in 1:dim(df_p)[2]) {
    if (isNumeric(df_p[1,i])){
      df_p[,i] <- as.numeric(df_p[,i])
    }
    if (df_p[1,i] %in% c("TRUE", "FALSE")){
      df_p[,i] <- as.logical(df_p[,i])
    }
  }

  df_p = df_p %>% dplyr::mutate(Transition =
              ifelse(Mut_type == "1-snv" & (str_sub(Neighborhood_sequence, 21, 22) == "TG" & Ref == "C") |
                      (str_sub(Neighborhood_sequence, 20, 21) == "CA" & Ref == "G"), "C>T_g", Transition))
  df_p = df_p %>% dplyr::mutate(filter_6_c_to_t_artifact =
              ifelse(Transition == "C>T_g", TRUE, FALSE))
  Homo_length = 10
  df_p = df_p %>% dplyr::mutate(Homopolymer =
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, 21 - Homo_length, 20), str_dup("C", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, -20, -(21 - Homo_length)), str_dup("C", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("A", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("T", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("G", Homo_length)) > 0 |
            str_count(str_sub(Neighborhood_sequence, (22 - Homo_length), -(22 - Homo_length)), str_dup("C", Homo_length)) > 0)
  #df_p = df_p %>% dplyr::filter(total_read >= 10)
  df_p = df_p %>% dplyr::filter(SimpleRepeat_TRF == "N")
  df_p = df_p %>% dplyr::filter(filter_7_mutation_at_homopolymer == FALSE & !filter_8_low_quality)
  df_p = df_p %>% dplyr::filter(`%Alt` >= 5)
  #df_p = df_p %>% dplyr::filter(Sample %in% df_frozen_normal$Sample)
  #df_p = df_p %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample)
  df_p = df_p %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample)
  #df_p = df_p %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample)

  tmp = NULL
  for (j in 2:9){
    pp = 10^-j
    tmp = c(tmp,
            sum(((df_p$short_pre_support & df_p$short_pre_support_sum & df_p$prob_filter_3_pre < pp) |
            (df_p$short_post_support & df_p$short_post_support_sum & df_p$prob_filter_3_post < pp) |
            (df_p$short_pre_support & df_p$short_pre_support_sum & df_p$prob_filter_1 < pp) |
            df_p$filter_2_hairpin_structure |
            df_p$filter_4_highly_homologous_region) &
            df_p$total_read > 0)
    )
  }
  p_value = rbind(p_value, tmp)
}
rownames(p_value) = sampling
colnames(p_value) = c(
"p_2",
"p_3",
"p_4",
"p_5",
"p_6",
"p_7",
"p_8",
"p_9"
)

utils::write.table(p_value, "output/data_p_sampling_tumor_frozen_result.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)

```


## coverage
```{r}
#df_anal = df_filter_FFPE_normal
df_anal = df_filter_frozen_tumor

df_coverage = data.frame(
"Name" = c(
"total_read",
"400-1",
"400-2",
"400-3",
"300-1",
"300-2",
"300-3",
"200-1",
"200-2",
"200-3",
"100-1",
"100-2",
"100-3",
"50-1",
"50-2",
"50-3",
"30-1",
"30-2",
"30-3"),

"group" = c(
944,
400,
400,
400,
300,
300,
300,
200,
200,
200,
100,
100,
100,
50,
50,
50,
30,
30,
30),


"coverage" = c(
sum(df_anal$`total_read` > 0),
sum(df_anal$`400-1` > 0),
sum(df_anal$`400-2` > 0),
sum(df_anal$`400-3` > 0),
sum(df_anal$`300-1` > 0),
sum(df_anal$`300-2` > 0),
sum(df_anal$`300-3` > 0),
sum(df_anal$`200-1` > 0),
sum(df_anal$`200-2` > 0),
sum(df_anal$`200-3` > 0),
sum(df_anal$`100-1` > 0),
sum(df_anal$`100-2` > 0),
sum(df_anal$`100-3` > 0),
sum(df_anal$`50-1` > 0),
sum(df_anal$`50-2` > 0),
sum(df_anal$`50-3` > 0),
sum(df_anal$`30-1` > 0),
sum(df_anal$`30-2` > 0),
sum(df_anal$`30-3` > 0))
)
rownames(df_coverage) = sampling
df_coverage = cbind(df_coverage, p_value)
df_coverage$percent2 = df_coverage$p_2 / df_coverage$coverage * 100
df_coverage$percent3 = df_coverage$p_3 / df_coverage$coverage * 100
df_coverage$percent4 = df_coverage$p_4 / df_coverage$coverage * 100
df_coverage$percent5 = df_coverage$p_5 / df_coverage$coverage * 100
df_coverage$percent6 = df_coverage$p_6 / df_coverage$coverage * 100
df_coverage$percent7 = df_coverage$p_7 / df_coverage$coverage * 100
df_coverage$percent8 = df_coverage$p_8 / df_coverage$coverage * 100
df_coverage$percent9 = df_coverage$p_9 / df_coverage$coverage * 100

utils::write.table(df_coverage, "output/data_coverage_result.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)

df_coverage$percent2 = df_coverage$p_2 / df_coverage$coverage * 100
df_coverage$percent3 = df_coverage$p_3 / df_coverage$coverage * 100
df_coverage$percent4 = df_coverage$p_4 / df_coverage$coverage * 100
df_coverage$percent5 = df_coverage$p_5 / df_coverage$coverage * 100
df_coverage$percent6 = df_coverage$p_6 / df_coverage$coverage * 100
df_coverage$percent7 = df_coverage$p_7 / df_coverage$coverage * 100
df_coverage$percent8 = df_coverage$p_8 / df_coverage$coverage * 100
df_coverage$percent9 = df_coverage$p_9 / df_coverage$coverage * 100

g = ggplot() +
  xlab("Coverage")+ ylab("Called mutations")+ 
  ggtitle("Coverage and filtering rate of FFPE normal breast tissue") + 
  scale_x_continuous(breaks=c(0, 30, 50, 100, 200, 300, 400, 1000), limits=c(0,1000)) +
  scale_y_continuous(breaks=seq(0,100,length=6),limits=c(0,100), sec.axis = sec_axis(~ . / 1, breaks = seq(0,100,length=6), name = "Filtering rate (%)")) +
  theme_set(theme_bw(base_size = 10)) +
  theme(panel.grid.minor = element_line(colour = "black", size = 0, linetype="blank")) +
  scale_colour_brewer(palette = "Paired") +
  scale_fill_manual(values = "#333333") +
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=coverage, fill = "Mutation count"), 
    geom="bar", 
    stat="identity",
    position="identity"
  )+
  layer(
    data=aggregate(percent2~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent2, color = "p ≤ 10-2"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent2, color = "p ≤ 10-2"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=aggregate(percent3~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent3, color = "p ≤ 10-3"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent3, color = "p ≤ 10-3"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent4~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent4, color = "p ≤ 10-4"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent4, color = "p ≤ 10-4"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent5~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent5, color = "p ≤ 10-5"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent5, color = "p ≤ 10-5"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent6~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent6, color = "p ≤ 10-6"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent6, color = "p ≤ 10-6"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent7~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent7, color = "p ≤ 10-7"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent7, color = "p ≤ 10-7"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent8~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent8, color = "p ≤ 10-8"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent8, color = "p ≤ 10-8"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )+
   layer(
    data=aggregate(percent9~group,data=df_coverage,FUN=mean), 
    mapping=aes(x=group, y=percent9, color = "p ≤ 10-9"), 
    geom="line", 
    stat="identity", 
    position="identity"
  )+
  layer(
    data=df_coverage, 
    mapping=aes(x=group, y=percent9, color = "p ≤ 10-9"), 
    geom="point", 
    stat="identity", 
    position="identity"
  )
ggsave(paste(wd, "/output/coverage_tumor_frozen", Sys.Date(), ".pdf", sep=""), plot=g, width=12, height=8)

```


## summarize
```{r}
# Median not used and not correct

data_mutations_tmp = data.frame("Number" = "Samples_with_mutation_no_filter",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & filter_1_mutation_intra_hairpin_loop)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & filter_1_mutation_intra_hairpin_loop)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & filter_1_mutation_intra_hairpin_loop)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & filter_1_mutation_intra_hairpin_loop)
df_filter_TOP = df_TOP %>% dplyr::filter(filter_1_mutation_intra_hairpin_loop)
data_mutations_tmp = data.frame("Number" = "Filter_1",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & filter_2_hairpin_structure)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & filter_2_hairpin_structure)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & filter_2_hairpin_structure)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & filter_2_hairpin_structure)
df_filter_TOP = df_TOP %>% dplyr::filter(filter_2_hairpin_structure)
data_mutations_tmp = data.frame("Number" = "Filter_2",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & filter_3_microhomology_induced_mutation)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & filter_3_microhomology_induced_mutation)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & filter_3_microhomology_induced_mutation)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & filter_3_microhomology_induced_mutation)
df_filter_TOP = df_TOP %>% dplyr::filter(filter_3_microhomology_induced_mutation)
data_mutations_tmp = data.frame("Number" = "Filter_3",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & filter_4_highly_homologous_region)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & filter_4_highly_homologous_region)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & filter_4_highly_homologous_region)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & filter_4_highly_homologous_region)
df_filter_TOP = df_TOP %>% dplyr::filter(filter_4_highly_homologous_region)
data_mutations_tmp = data.frame("Number" = "Filter_4",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & msec_filter_1234)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & msec_filter_1234)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & msec_filter_1234)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & msec_filter_1234)
df_filter_TOP = df_TOP %>% dplyr::filter(msec_filter_1234)
data_mutations_tmp = data.frame("Number" = "Filter_1234",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_matched = NULL
for (i in 1:length(matched_FFPE)){
  df_matched = rbind(df_matched, dplyr::inner_join(df_filter_FFPE_tumor %>% dplyr::filter(Sample %in% matched_FFPE[i]),
                                       df_filter_frozen_tumor %>% dplyr::filter(Sample %in% matched_frozen[i]),
                                       by=c("Chr", "Pos", "Ref", "Alt")))
}
data_matched_tmp = data.frame("Number" = "Filtered_mutations",
                          "FF_only" = dim(df_filter_frozen_tumor %>% dplyr::filter(Sample %in% matched_frozen))[1] - dim(df_matched)[1],
                          "FF_and_FFPE"= dim(df_matched)[1],
                          "FFPE_only" = dim(df_filter_FFPE_tumor %>% dplyr::filter(Sample %in% matched_FFPE))[1] - dim(df_matched)[1])
data_matched = rbind(data_matched, data_matched_tmp)
data_matched_tmp = data.frame("Number" = "Filter_passing_mutations",
                          "FF_only" = data_matched$FF_only[1] - data_matched$FF_only[2],
                          "FF_and_FFPE"= data_matched$FF_and_FFPE[1] - data_matched$FF_and_FFPE[2],
                          "FFPE_only" = data_matched$FFPE_only[1] - data_matched$FFPE_only[2])
data_matched = rbind(data_matched, data_matched_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & !msec_filter_1234)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & !msec_filter_1234)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & !msec_filter_1234)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & !msec_filter_1234)
df_filter_TOP = df_TOP %>% dplyr::filter(!msec_filter_1234)
data_mutations_tmp = data.frame("Number" = "Filter_passing_1234",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & !msec_filter_1234 & (Transition == "C>T_g_FFPE" | Transition == "C>T_g"))
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & !msec_filter_1234 & (Transition == "C>T_g_FFPE" | Transition == "C>T_g"))
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & !msec_filter_1234 & (Transition == "C>T_g_FFPE" | Transition == "C>T_g"))
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & !msec_filter_1234 & (Transition == "C>T_g_FFPE" | Transition == "C>T_g"))
df_filter_TOP = df_TOP %>% dplyr::filter(!msec_filter_1234 & (Transition == "C>T_g_FFPE" | Transition == "C>T_g"))
data_mutations_tmp = data.frame("Number" = "Filter_passing_1234_T>C",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & !msec_filter_1234)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & !msec_filter_1234 & !(Transition == "C>T_g_FFPE" | Transition == "C>T_g"))
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & !msec_filter_1234)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & msec_filter_1234 & !(Transition == "C>T_g_FFPE" | Transition == "C>T_g"))
df_filter_TOP = df_TOP %>% dplyr::filter(!msec_filter_1234 & !(Transition == "C>T_g_FFPE" | Transition == "C>T_g"))
data_mutations_tmp = data.frame("Number" = "Filter_passing_1234_notC>T",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & !msec_filter_1234 & Homopolymer)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & !msec_filter_1234 & Homopolymer)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & !msec_filter_1234 & Homopolymer)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & !msec_filter_1234 & Homopolymer)
df_filter_TOP = df_TOP %>% dplyr::filter(!msec_filter_1234 & Homopolymer)
data_mutations_tmp = data.frame("Number" = "Filter_passing_1234_Homo",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample & !msec_filter_1234 & !Homopolymer)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample & !msec_filter_1234 & !(Transition == "C>T_g_FFPE" | Transition == "C>T_g") & !Homopolymer)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample & !msec_filter_1234 & !Homopolymer)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample & !msec_filter_1234 & !(Transition == "C>T_g_FFPE" | Transition == "C>T_g") & !Homopolymer)
df_filter_TOP = df_TOP %>% dplyr::filter(!msec_filter_1234 & !(Transition == "C>T_g_FFPE" | Transition == "C>T_g") & !Homopolymer)
data_mutations_tmp = data.frame("Number" = "Filter_passing_1234_notC>T_notHomo",
                          "FF_N_sample" = length(unique(df_filter_frozen_normal$Sample)),
                          "FFPE_N_sample" = length(unique(df_filter_FFPE_normal$Sample)),
                          "FF_T_sample" = length(unique(df_filter_frozen_tumor$Sample)),
                          "FFPE_T_sample" = length(unique(df_filter_FFPE_tumor$Sample)),
                          "FFPE_TOP_sample"= length(unique(df_filter_TOP$Sample)),
                          "FF_N_min" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == data_mutations$FF_N_sample[1], min(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)), 0),
                          "FFPE_N_min" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == data_mutations$FFPE_N_sample[1], min(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)), 0),
                          "FF_T_min" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == data_mutations$FF_T_sample[1], min(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)), 0),
                          "FFPE_T_min" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == data_mutations$FFPE_T_sample[1], min(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)), 0),
                          "FFPE_TOP_min"= ifelse(length(unique(df_filter_TOP$Sample)) == data_mutations$FFPE_TOP_sample[1], min(sort(rle(sort(df_filter_TOP$Sample))$lengths)), 0),
                          "FF_N_max" = ifelse(length(unique(df_filter_frozen_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths))),
                          "FFPE_N_max" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths))),
                          "FF_T_max" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths))),
                          "FFPE_T_max" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) == 0, 0, max(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths))),
                          "FFPE_TOP_max"= ifelse(length(unique(df_filter_TOP$Sample)) == 0, 0, max(sort(rle(sort(df_filter_TOP$Sample))$lengths))),
                          "FF_N_sum" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths),
                          "FFPE_N_sum" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths),
                          "FF_T_sum" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths),
                          "FFPE_T_sum" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths),
                          "FFPE_TOP_sum"= sum(rle(sort(df_filter_TOP$Sample))$lengths),
                          "FF_N_mean" = sum(rle(sort(df_filter_frozen_normal$Sample))$lengths) / 53,
                          "FFPE_N_mean" = sum(rle(sort(df_filter_FFPE_normal$Sample))$lengths) / 190,
                          "FF_T_mean" = sum(rle(sort(df_filter_frozen_tumor$Sample))$lengths) / 23,
                          "FFPE_T_mean" = sum(rle(sort(df_filter_FFPE_tumor$Sample))$lengths) / 33,
                          "FFPE_TOP_mean"= sum(rle(sort(df_filter_TOP$Sample))$lengths) / 54,
                          "FF_N_median" = ifelse(length(unique(df_filter_frozen_normal$Sample)) > as.integer(data_mutations$FF_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_normal$Sample))$lengths)) - 28])[1], 0),
                          "FFPE_N_median" = ifelse(length(unique(df_filter_FFPE_normal$Sample)) == as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1] / 2,
                                                   ifelse(length(unique(df_filter_FFPE_normal$Sample)) > as.integer(data_mutations$FFPE_N_sample[1] / 2),
                                                   mean(c((sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 106])[1],
                                                   (sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_normal$Sample))$lengths)) - 105])[1])), 0)),
                          "FF_T_median" = ifelse(length(unique(df_filter_frozen_tumor$Sample)) > as.integer(data_mutations$FF_T_sample[1] / 2),
                                                 (sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_frozen_tumor$Sample))$lengths)) - 11])[1], 0),
                          "FFPE_T_median" = ifelse(length(unique(df_filter_FFPE_tumor$Sample)) > as.integer(data_mutations$FFPE_T_sample[1] / 2),
                                                   (sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)[length(sort(rle(sort(df_filter_FFPE_tumor$Sample))$lengths)) - 18])[1], 0),
                          "FFPE_TOP_median"= ifelse(length(unique(df_filter_TOP$Sample)) == as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1] / 2,
                                                    ifelse(length(unique(df_filter_TOP$Sample)) > as.integer(data_mutations$FFPE_TOP_sample[1] / 2),
                                                    mean(c((sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 31])[1],
                                                    (sort(rle(sort(df_filter_TOP$Sample))$lengths)[length(sort(rle(sort(df_filter_TOP$Sample))$lengths)) - 30])[1])), 0))
                          )
data_mutations = rbind(data_mutations, data_mutations_tmp)
utils::write.table(data_matched, "output/data_matched.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)
utils::write.table(data_mutations, "output/data_mutations.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)
```

########
```{r}
### insert size summary
INSERT_LIST_1 = "source/summary_insert_1_per.tsv"
INSERT_LIST_5 = "source/summary_insert_5_per.tsv"
INSERT_LIST_match = "source/summary_insert_1217.tsv"
INSERT_LIST_TOP = "source/summary_insert_TOP.tsv"
df_insert_1 =  read.csv(INSERT_LIST_1, stringsAsFactors=FALSE, header=FALSE, check.names=F, sep="\t")
df_insert_5 =  read.csv(INSERT_LIST_5, stringsAsFactors=FALSE, header=FALSE, check.names=F, sep="\t")
df_insert_match =  read.csv(INSERT_LIST_match, stringsAsFactors=FALSE, header=FALSE, check.names=F, sep="\t")
df_insert_TOP =  read.csv(INSERT_LIST_TOP, stringsAsFactors=FALSE, header=FALSE, check.names=F, sep="\t")
df_insert = rbind(df_insert_1, df_insert_5)
df_insert = rbind(df_insert, df_insert_match)
colnames(df_insert) = c("Sample", "Count")
colnames(df_insert_TOP) = c("Sample", "Count")
df_insert_frozen_normal = df_insert %>% dplyr::filter(Sample %in% df_frozen_normal$Sample)
df_insert_FFPE_normal = df_insert %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample)
df_insert_frozen_tumor = df_insert %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample)
df_insert_FFPE_tumor = df_insert %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample)
### read summary
df_summary_frozen_normal = df_read_summary %>% dplyr::filter(Sample %in% df_frozen_normal$`Sample.(n=389).(SL0005_RN1.not.excluded)`)
df_summary_FFPE_normal = df_read_summary %>% dplyr::filter(Sample %in% df_FFPE_normal$`Sample.(n=389).(SL0005_RN1.not.excluded)`)
df_summary_frozen_tumor = df_read_summary %>% dplyr::filter(Sample %in% df_frozen_tumor$`Sample.(n=389).(SL0005_RN1.not.excluded)`)
df_summary_FFPE_tumor = df_read_summary %>% dplyr::filter(Sample %in% df_FFPE_tumor$`Sample.(n=389).(SL0005_RN1.not.excluded)`)
df_summary_TOP = df_read_summary_TOP %>% dplyr::filter(Sample %in% unique(df_TOP$Sample))
data_summary = NULL
data_summary_tmp = data.frame("Number" = "FF_N",
"Raw_read_no.mean" = mean(df_summary_frozen_normal$`Raw_read_no.`),
"Raw_read_no.min" = min(df_summary_frozen_normal$`Raw_read_no.`),
"Raw_read_no.max" = max(df_summary_frozen_normal$`Raw_read_no.`),
"Mapped_read_ratio.mean" = mean(df_summary_frozen_normal$`Mapped_read_ratio%`),
"Mapped_read_ratio.min" = min(df_summary_frozen_normal$`Mapped_read_ratio%`),
"Mapped_read_ratio.max" = max(df_summary_frozen_normal$`Mapped_read_ratio%`),
"Unique_read_ratio.mean" = mean(df_summary_frozen_normal$`Unique_read_ratio%`),
"Unique_read_ratio.min" = min(df_summary_frozen_normal$`Unique_read_ratio%`),
"Unique_read_ratio.max" = max(df_summary_frozen_normal$`Unique_read_ratio%`),
"Mean_coverage.mean" = mean(df_summary_frozen_normal$`Mean_coverage`),
"Mean_coverage.min" = min(df_summary_frozen_normal$`Mean_coverage`),
"Mean_coverage.max" = max(df_summary_frozen_normal$`Mean_coverage`),
"Insert.mean" = mean(df_insert_frozen_normal$Count),
"Insert.min" = min(df_insert_frozen_normal$Count),
"Insert.max" = max(df_insert_frozen_normal$Count)
)
data_summary = rbind(data_summary, data_summary_tmp)
data_summary_tmp = data.frame("Number" = "FFPE_N",
"Raw_read_no.mean" = mean(df_summary_FFPE_normal$`Raw_read_no.`),
"Raw_read_no.min" = min(df_summary_FFPE_normal$`Raw_read_no.`),
"Raw_read_no.max" = max(df_summary_FFPE_normal$`Raw_read_no.`),
"Mapped_read_ratio.mean" = mean(df_summary_FFPE_normal$`Mapped_read_ratio%`),
"Mapped_read_ratio.min" = min(df_summary_FFPE_normal$`Mapped_read_ratio%`),
"Mapped_read_ratio.max" = max(df_summary_FFPE_normal$`Mapped_read_ratio%`),
"Unique_read_ratio.mean" = mean(df_summary_FFPE_normal$`Unique_read_ratio%`),
"Unique_read_ratio.min" = min(df_summary_FFPE_normal$`Unique_read_ratio%`),
"Unique_read_ratio.max" = max(df_summary_FFPE_normal$`Unique_read_ratio%`),
"Mean_coverage.mean" = mean(df_summary_FFPE_normal$`Mean_coverage`),
"Mean_coverage.min" = min(df_summary_FFPE_normal$`Mean_coverage`),
"Mean_coverage.max" = max(df_summary_FFPE_normal$`Mean_coverage`),
"Insert.mean" = mean(df_insert_FFPE_normal$Count),
"Insert.min" = min(df_insert_FFPE_normal$Count),
"Insert.max" = max(df_insert_FFPE_normal$Count)
)
data_summary = rbind(data_summary, data_summary_tmp)
data_summary_tmp = data.frame("Number" = "FF_T",
"Raw_read_no.mean" = mean(df_summary_frozen_tumor$`Raw_read_no.`),
"Raw_read_no.min" = min(df_summary_frozen_tumor$`Raw_read_no.`),
"Raw_read_no.max" = max(df_summary_frozen_tumor$`Raw_read_no.`),
"Mapped_read_ratio.mean" = mean(df_summary_frozen_tumor$`Mapped_read_ratio%`),
"Mapped_read_ratio.min" = min(df_summary_frozen_tumor$`Mapped_read_ratio%`),
"Mapped_read_ratio.max" = max(df_summary_frozen_tumor$`Mapped_read_ratio%`),
"Unique_read_ratio.mean" = mean(df_summary_frozen_tumor$`Unique_read_ratio%`),
"Unique_read_ratio.min" = min(df_summary_frozen_tumor$`Unique_read_ratio%`),
"Unique_read_ratio.max" = max(df_summary_frozen_tumor$`Unique_read_ratio%`),
"Mean_coverage.mean" = mean(df_summary_frozen_tumor$`Mean_coverage`),
"Mean_coverage.min" = min(df_summary_frozen_tumor$`Mean_coverage`),
"Mean_coverage.max" = max(df_summary_frozen_tumor$`Mean_coverage`),
"Insert.mean" = mean(df_insert_frozen_tumor$Count),
"Insert.min" = min(df_insert_frozen_tumor$Count),
"Insert.max" = max(df_insert_frozen_tumor$Count)
)
data_summary = rbind(data_summary, data_summary_tmp)
data_summary_tmp = data.frame("Number" = "FFPE_T",
"Raw_read_no.mean" = mean(df_summary_FFPE_tumor$`Raw_read_no.`),
"Raw_read_no.min" = min(df_summary_FFPE_tumor$`Raw_read_no.`),
"Raw_read_no.max" = max(df_summary_FFPE_tumor$`Raw_read_no.`),
"Mapped_read_ratio.mean" = mean(df_summary_FFPE_tumor$`Mapped_read_ratio%`),
"Mapped_read_ratio.min" = min(df_summary_FFPE_tumor$`Mapped_read_ratio%`),
"Mapped_read_ratio.max" = max(df_summary_FFPE_tumor$`Mapped_read_ratio%`),
"Unique_read_ratio.mean" = mean(df_summary_FFPE_tumor$`Unique_read_ratio%`),
"Unique_read_ratio.min" = min(df_summary_FFPE_tumor$`Unique_read_ratio%`),
"Unique_read_ratio.max" = max(df_summary_FFPE_tumor$`Unique_read_ratio%`),
"Mean_coverage.mean" = mean(df_summary_FFPE_tumor$`Mean_coverage`),
"Mean_coverage.min" = min(df_summary_FFPE_tumor$`Mean_coverage`),
"Mean_coverage.max" = max(df_summary_FFPE_tumor$`Mean_coverage`),
"Insert.mean" = mean(df_insert_FFPE_tumor$Count),
"Insert.min" = min(df_insert_FFPE_tumor$Count),
"Insert.max" = max(df_insert_FFPE_tumor$Count)
)
data_summary = rbind(data_summary, data_summary_tmp)
data_summary_tmp = data.frame("Number" = "FFPE_TOP",
"Raw_read_no.mean" = mean(df_summary_TOP$`Raw_read_no.`),
"Raw_read_no.min" = min(df_summary_TOP$`Raw_read_no.`),
"Raw_read_no.max" = max(df_summary_TOP$`Raw_read_no.`),
"Mapped_read_ratio.mean" = mean(df_summary_TOP$`Mapped_read_ratio%`),
"Mapped_read_ratio.min" = min(df_summary_TOP$`Mapped_read_ratio%`),
"Mapped_read_ratio.max" = max(df_summary_TOP$`Mapped_read_ratio%`),
"Unique_read_ratio.mean" = mean(df_summary_TOP$`Unique_read_ratio%`),
"Unique_read_ratio.min" = min(df_summary_TOP$`Unique_read_ratio%`),
"Unique_read_ratio.max" = max(df_summary_TOP$`Unique_read_ratio%`),
"Mean_coverage.mean" = mean(df_summary_TOP$`Mean_coverage`),
"Mean_coverage.min" = min(df_summary_TOP$`Mean_coverage`),
"Mean_coverage.max" = max(df_summary_TOP$`Mean_coverage`),
"Insert.mean" = mean(df_insert_TOP$Count),
"Insert.min" = min(df_insert_TOP$Count),
"Insert.max" = max(df_insert_TOP$Count)
)
data_summary = rbind(data_summary, data_summary_tmp)
utils::write.table(data_summary, "output/data_summary_result.tsv", sep = "\t", na = "",
              row.names = FALSE, col.names = TRUE, quote = FALSE)
```

# hyperparameter setting
# palindromic sequence searching length
```{r}
df_filter_frozen_normal = df_filter %>% dplyr::filter(Sample %in% df_frozen_normal$Sample)
df_filter_FFPE_normal = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample)
df_filter_frozen_tumor = df_filter %>% dplyr::filter(Sample %in% df_frozen_tumor$Sample)
df_filter_FFPE_tumor = df_filter %>% dplyr::filter(Sample %in% df_FFPE_tumor$Sample)

#df_anal = rbind(df_filter_FFPE_normal, df_filter_FFPE_tumor)
df_anal = df_filter_FFPE_normal
hair_150 = df_anal$flag_hairpin / df_anal$total_read > 0.5
hair_200 = df_anal$flag_hairpin_200 / df_anal$total_read > 0.5
hair_300 = df_anal$flag_hairpin_300 / df_anal$total_read > 0.5

#df_anal = rbind(df_filter_frozen_normal, df_filter_frozen_tumor)
df_anal = df_filter_frozen_tumor
hair_150_T = df_anal$flag_hairpin / df_anal$total_read > 0.5
hair_200_T = df_anal$flag_hairpin_200 / df_anal$total_read > 0.5
hair_300_T = df_anal$flag_hairpin_300 / df_anal$total_read > 0.5

x <- data.frame(
    length = c("150 bases", "200 bases", "300 bases", "150 bases", "200 bases", "300 bases"),
    filter_2 = c(sum(hair_150), sum(hair_200), sum(hair_300), sum(hair_150_T), sum(hair_200_T), sum(hair_300_T)),
    type = c("FFPE", "FFPE", "FFPE", "frozen", "frozen", "frozen")
)
g = ggplot(x, aes(x = length, y = filter_2, fill = type))
g = g + geom_bar(stat = "identity", position = position_dodge(0.9))
g = g + theme_set(theme_bw(base_size = 15))
g = g + xlab("Searched length for palindromic sequences")
g = g + ylab("Mutations filtered out by filter-2")
g = g + ggtitle("Searching length for palindromes")
g = g + ylim(0,500)
g = g + scale_fill_manual(values = c("#999999", "#222222"))
g = g + geom_text(aes(label=filter_2), position = position_dodge(0.9), vjust=-1.5)
#g = g + scale_x_continuous(breaks=seq(0,50,by=10),limits=c(0,50))
#g = g + guides(colour=guide_legend(override.aes = list(size=3)))
ggsave(paste(wd, "/output/searched_", Sys.Date(), ".pdf", sep=""), plot=g, width=8, height=6)

```

# hairpin threshold
```{r}
#df_anal = rbind(df_filter_FFPE_normal, df_filter_FFPE_tumor)
df_anal = df_filter_FFPE_normal
hair_10 = df_anal$flag_hairpin / df_anal$total_read > 0.1
hair_20 = df_anal$flag_hairpin / df_anal$total_read > 0.2
hair_30 = df_anal$flag_hairpin / df_anal$total_read > 0.3
hair_40 = df_anal$flag_hairpin / df_anal$total_read > 0.4
hair_50 = df_anal$flag_hairpin / df_anal$total_read > 0.5
hair_60 = df_anal$flag_hairpin / df_anal$total_read > 0.6
hair_70 = df_anal$flag_hairpin / df_anal$total_read > 0.7
hair_80 = df_anal$flag_hairpin / df_anal$total_read > 0.8
hair_90 = df_anal$flag_hairpin / df_anal$total_read > 0.9

#df_anal = rbind(df_filter_frozen_normal, df_filter_frozen_tumor)
df_anal = df_filter_frozen_tumor
hair_10_T = df_anal$flag_hairpin / df_anal$total_read > 0.1
hair_20_T = df_anal$flag_hairpin / df_anal$total_read > 0.2
hair_30_T = df_anal$flag_hairpin / df_anal$total_read > 0.3
hair_40_T = df_anal$flag_hairpin / df_anal$total_read > 0.4
hair_50_T = df_anal$flag_hairpin / df_anal$total_read > 0.5
hair_60_T = df_anal$flag_hairpin / df_anal$total_read > 0.6
hair_70_T = df_anal$flag_hairpin / df_anal$total_read > 0.7
hair_80_T = df_anal$flag_hairpin / df_anal$total_read > 0.8
hair_90_T = df_anal$flag_hairpin / df_anal$total_read > 0.9

x <- data.frame(
    length = c("10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%", "10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%"),
    filter_2 = c(sum(hair_10), sum(hair_20), sum(hair_30), sum(hair_40), sum(hair_50), sum(hair_60), sum(hair_70), sum(hair_80), sum(hair_90),
                 sum(hair_10_T), sum(hair_20_T), sum(hair_30_T), sum(hair_40_T), sum(hair_50_T), sum(hair_60_T), sum(hair_70_T), sum(hair_80_T), sum(hair_90_T)),
    type = c("FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen")
)
g = ggplot(x, aes(x = length, y = filter_2, fill = type))
g = g + geom_bar(stat = "identity", position = position_dodge(0.9))
g = g + theme_set(theme_bw(base_size = 15))
g = g + xlab("Percentage of reads with palindrome sequences")
g = g + ylab("Mutations filtered out by filter-2")
g = g + ggtitle("Palindromic sequence-induced artifacts")
g = g + ylim(0,500)
g = g + scale_fill_manual(values = c("#999999", "#222222"))
g = g + geom_text(aes(label=filter_2), position = position_dodge(0.9), vjust=-1.5)
#g = g + scale_x_continuous(breaks=seq(0,50,by=10),limits=c(0,50))
#g = g + guides(colour=guide_legend(override.aes = list(size=3)))
ggsave(paste(wd, "/output/hairpin_threshold_", Sys.Date(), ".pdf", sep=""), plot=g, width=8, height=6)

```

# distant region threshold
```{r}
#df_anal = rbind(df_filter_FFPE_normal, df_filter_FFPE_tumor)
df_anal = df_filter_FFPE_normal
dist_05 = df_anal$distant_homology_rate > 0.05 & df_anal$not_long_repeat
dist_10 = df_anal$distant_homology_rate > 0.10 & df_anal$not_long_repeat
dist_15 = df_anal$distant_homology_rate > 0.15 & df_anal$not_long_repeat
dist_20 = df_anal$distant_homology_rate > 0.20 & df_anal$not_long_repeat
dist_25 = df_anal$distant_homology_rate > 0.25 & df_anal$not_long_repeat
dist_30 = df_anal$distant_homology_rate > 0.30 & df_anal$not_long_repeat
dist_35 = df_anal$distant_homology_rate > 0.35 & df_anal$not_long_repeat
dist_40 = df_anal$distant_homology_rate > 0.40 & df_anal$not_long_repeat
dist_45 = df_anal$distant_homology_rate > 0.45 & df_anal$not_long_repeat
dist_50 = df_anal$distant_homology_rate > 0.50 & df_anal$not_long_repeat

#df_anal = rbind(df_filter_frozen_normal, df_filter_frozen_tumor)
df_anal = df_filter_frozen_tumor
dist_05_T = df_anal$distant_homology_rate > 0.05 & df_anal$not_long_repeat
dist_10_T = df_anal$distant_homology_rate > 0.10 & df_anal$not_long_repeat
dist_15_T = df_anal$distant_homology_rate > 0.15 & df_anal$not_long_repeat
dist_20_T = df_anal$distant_homology_rate > 0.20 & df_anal$not_long_repeat
dist_25_T = df_anal$distant_homology_rate > 0.25 & df_anal$not_long_repeat
dist_30_T = df_anal$distant_homology_rate > 0.30 & df_anal$not_long_repeat
dist_35_T = df_anal$distant_homology_rate > 0.35 & df_anal$not_long_repeat
dist_40_T = df_anal$distant_homology_rate > 0.40 & df_anal$not_long_repeat
dist_45_T = df_anal$distant_homology_rate > 0.45 & df_anal$not_long_repeat
dist_50_T = df_anal$distant_homology_rate > 0.50 & df_anal$not_long_repeat

x <- data.frame(
    length = c(" 5%", "10%", "15%", "20%", "25%", "30%", "35%", "40%", "45%", "50%", " 5%", "10%", "15%", "20%", "25%", "30%", "35%", "40%", "45%", "50%"),
    filter_4 = c(sum(dist_05), sum(dist_10), sum(dist_15), sum(dist_20), sum(dist_25), sum(dist_30), sum(dist_35), sum(dist_40), sum(dist_45), sum(dist_50),
                 sum(dist_05_T), sum(dist_10_T), sum(dist_15_T), sum(dist_20_T), sum(dist_25_T), sum(dist_30_T), sum(dist_35_T), sum(dist_40_T), sum(dist_45_T), sum(dist_50_T)),
    type = c("FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen")
)
g = ggplot(x, aes(x = length, y = filter_4, fill = type))
g = g + geom_bar(stat = "identity", position = position_dodge(0.9))
g = g + theme_set(theme_bw(base_size = 15))
g = g + xlab("Percentage of reads with homologous sequences")
g = g + ylab("Mutations filtered out by filter-4")
g = g + ggtitle("Homologous sequence-induced artifacts")
g = g + ylim(0,1200)
g = g + scale_fill_manual(values = c("#999999", "#222222"))
g = g + geom_text(aes(label=filter_4), position = position_dodge(0.9), vjust=-1.5)
#g = g + scale_x_continuous(breaks=seq(0,50,by=10),limits=c(0,50))
#g = g + guides(colour=guide_legend(override.aes = list(size=3)))
ggsave(paste(wd, "/output/distant_threshold_", Sys.Date(), ".pdf", sep=""), plot=g, width=8, height=6)

```

# p-value threshold
```{r}
#df_anal = rbind(df_filter_FFPE_normal, df_filter_FFPE_tumor)
df_anal = df_filter_FFPE_normal
pv = 10 ^ -2
p_10_2 = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -3
p_10_3 = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -4
p_10_4 = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -5
p_10_5 = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -6
p_10_6 = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -7
p_10_7 = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -8
p_10_8 = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -9
p_10_9= (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)

#df_anal = rbind(df_filter_frozen_normal, df_filter_frozen_tumor)
df_anal = df_filter_frozen_tumor
pv = 10 ^ -2
p_10_2_T = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -3
p_10_3_T = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -4
p_10_4_T = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -5
p_10_5_T = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -6
p_10_6_T = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -7
p_10_7_T = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -8
p_10_8_T = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)
pv = 10 ^ -9
p_10_9_T = (df_anal$short_pre_support & df_anal$short_pre_support_sum & df_anal$prob_filter_3_pre < pv) | (df_anal$short_post_support & df_anal$short_post_support_sum & df_anal$prob_filter_3_post < pv) | (df_anal$short_short_support & df_anal$short_short_support_sum & df_anal$prob_filter_1 < pv)

x <- data.frame(
    length = c("10-2", "10-3", "10-4", "10-5", "10-6", "10-7", "10-8", "10-9", "10-2", "10-3", "10-4", "10-5", "10-6", "10-7", "10-8", "10-9"),
    filter_13 = c(sum(p_10_2), sum(p_10_3), sum(p_10_4), sum(p_10_5), sum(p_10_6), sum(p_10_7), sum(p_10_8), sum(p_10_9),
                  sum(p_10_2_T), sum(p_10_3_T), sum(p_10_4_T), sum(p_10_5_T), sum(p_10_6_T), sum(p_10_7_T), sum(p_10_8_T), sum(p_10_9_T)),
    type = c("FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "FFPE", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen", "frozen")
)

g = ggplot(x, aes(x = length, y = filter_13, fill = type))
g = g + geom_bar(stat = "identity", position = position_dodge(0.9))
g = g + theme_set(theme_bw(base_size = 15))
g = g + xlab("Threshold of p value in filter-1 and filter-3")
g = g + ylab("Mutations filtered out by filter-1 or filter-3")
g = g + ggtitle("Threshold of p value")
g = g + ylim(0,2000)
g = g + scale_fill_manual(values = c("#999999", "#222222"))
g = g + geom_text(aes(label=filter_13), position = position_dodge(0.9), vjust=-1.5)
#g = g + scale_x_continuous(breaks=seq(0,50,by=10),limits=c(0,50))
#g = g + guides(colour=guide_legend(override.aes = list(size=3)))
ggsave(paste(wd, "/output/p_value_threshold_", Sys.Date(), ".pdf", sep=""), plot=g, width=8, height=6)

```

# target sequencing
```{r}
target_file = "source/target_edit_3.xlsx"
df_target =  read.xlsx(target_file, sheet=1)
#df_target$Transition = ""
#df_target$hairpin = 0
#df_target$distant_homology_rate = 0
#df_target$Total_read_C = as.integer(df_target$Total_read_C)
#for (i in 1:length(df_target$Sample)) {
#  if (length(df_filter[df_filter$Sample == df_target[i,"Sample"] & df_filter$Gene == df_target[i,"Gene"] & df_filter$Pos == df_target[i,"Pos"],"Transition"])[1] > 0) {
#    df_target[i,"Transition"] = df_filter[df_filter$Sample == df_target[i,"Sample"] & df_filter$Gene == df_target[i,"Gene"] & df_filter$Pos == df_target[i,"Pos"],"Transition"]
#    df_target[i,"Total_read_C"] = as.integer(df_filter[df_filter$Sample == df_target[i,"Sample"] & df_filter$Gene == df_target[i,"Gene"] & df_filter$Pos == df_target[i,"Pos"],"Total_QV>=20"])
#    df_target[i,"VAF_C"] = as.numeric(df_filter[df_filter$Sample == df_target[i,"Sample"] & df_filter$Gene == df_target[i,"Gene"] & df_filter$Pos == df_target[i,"Pos"],"%Alt"])
#    df_target[i,"Mutation_depth_C"] = round(df_target[i,"Total_read_C"] * df_target[i,"VAF_C"] / 100)
#    df_target[i,"hairpin"] = df_filter[df_filter$Sample == df_target[i,"Sample"] & df_filter$Gene == df_target[i,"Gene"] & df_filter$Pos == df_target[i,"Pos"],"flag_hairpin"] /
#                              df_filter[df_filter$Sample == df_target[i,"Sample"] & df_filter$Gene == df_target[i,"Gene"] & df_filter$Pos == df_target[i,"Pos"],"total_read"] * 100
#    df_target[i,"distant_homology_rate"] = df_filter[df_filter$Sample == df_target[i,"Sample"] & df_filter$Gene == df_target[i,"Gene"] & df_filter$Pos == df_target[i,"Pos"],"distant_homology_rate"] * 100
#  }
#}
#write.xlsx(df_target, "source/target_edit_3.xlsx")

df_target = df_target %>% dplyr::mutate(group = ifelse(MicroSEC == "Passed", "Passed", ifelse(MicroSEC == "Passed (Cg>Tg)", "Cg>Tg", "Filtered")))
df_target = df_target %>% dplyr::arrange(MicroSEC)
#df_target = df_target %>% mutate(group = ifelse(MicroSEC == "Passed", "Passed", ifelse(MicroSEC == "Passed (Cg>Tg)", "Passed", "Filtered")))

g <- ggplot(df_target, aes(x = VAF_C, y = VAF_T, color = group, shape = group))
g <- g + geom_point(size = 3, alpha = 0.8)
g <- g + scale_fill_brewer(palette = "Set1")
g = g + theme_set(theme_bw(base_size = 15))
g = g + xlab("VAF of capture-based sequencing (%)")
g = g + ylab("VAF of amplicon-based sequencing (%)")
g = g + ggtitle("Variant allele frequency")
g = g + scale_x_continuous(breaks=seq(0,70,by=20),limits=c(0,70))
g = g + guides(colour=guide_legend(override.aes = list(size=3)))
g = g + scale_shape_discrete(solid=T)
g = g + annotate("text", x=15, y=2, label="CENPA p.Leu91Pro, filter passed")
g = g + annotate("text", x=14, y=-3, label="BRCA2	p.Arg2520*, filter passed, CG-to-TG")
g = g + annotate("text", x=12, y=4, label="NFYA p.Gln155Pro, filter 1, 2")
g = g + annotate("text", x=18, y=-1.5, label="ESR1 p.Arg394Cys, filter passed, CG-to-TG")

ggsave(paste(wd, "/output/VAF_validation_", Sys.Date(), ".pdf", sep=""), plot=g, width=13, height=11)

```


# Figure VAF
```{r, eval=FALSE}
df = df_filter_FFPE_normal %>% dplyr::filter(!msec_filter_1234)
g = ggplot(data=df, aes(x=`%Alt`)) +
  xlab("Variant allele frequency (%)") +
  ylab("Mutations") +
  ggtitle("Mutations passing the filter (normal, FFPE)") +
  geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black") + 
  theme(legend.position="right")
g = g + ylim(0,1200)
g = g + theme_set(theme_bw(base_size = 25))
g = g + scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
g = g + annotate("text", x=80, y=1200, size = 12, label=paste(dim(df)[1], "mutations"))
ggsave(paste(wd, "/output/VAF_passing_FFPE_normal_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_FFPE_normal
g = ggplot(data=df, aes(x=`%Alt`)) +
  xlab("Variant allele frequency (%)") +
  ylab("Mutations") +
  ggtitle("Total mutations (normal, FFPE)") +
  geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black") + 
  theme(legend.position="right")
g = g + ylim(0,1200)
g = g + theme_set(theme_bw(base_size = 25))
g = g + scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
g = g + annotate("text", x=80, y=1200, size = 12, label=paste(dim(df)[1], "mutations"))
ggsave(paste(wd, "/output/VAF_total_FFPE_normal_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_FFPE_normal %>% dplyr::filter(msec_filter_1234)
g = ggplot(data=df, aes(x=`%Alt`)) +
  xlab("Variant allele frequency (%)") +
  ylab("Mutations") +
  ggtitle("Filtered out mutations (normal, FFPE)") +
  geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black") + 
  theme(legend.position="right")
g = g + ylim(0,1200)
g = g + theme_set(theme_bw(base_size = 25))
g = g + scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
g = g + annotate("text", x=80, y=1200, size = 12, label=paste(dim(df)[1], "mutations"))
ggsave(paste(wd, "/output/VAF_filtered_FFPE_normal_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_FFPE_tumor %>% dplyr::filter(!msec_filter_1234)
g = ggplot(data=df, aes(x=`%Alt`)) +
  xlab("Variant allele frequency (%)") +
  ylab("Mutations") +
  ggtitle("Mutations passing the filter (tumor, FFPE)") +
  geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black") + 
  theme(legend.position="right")
g = g + ylim(0,120)
g = g + theme_set(theme_bw(base_size = 25))
g = g + scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
g = g + annotate("text", x=80, y=120, size = 12, label=paste(dim(df)[1], "mutations"))
ggsave(paste(wd, "/output/VAF_passing_FFPE_tumor_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_FFPE_tumor
g = ggplot(data=df, aes(x=`%Alt`)) +
  xlab("Variant allele frequency (%)") +
  ylab("Mutations") +
  ggtitle("Total mutations (tumor, FFPE)") +
  geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black") + 
  theme(legend.position="right")
g = g + ylim(0,120)
g = g + theme_set(theme_bw(base_size = 25))
g = g + scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
g = g + annotate("text", x=80, y=120, size = 12, label=paste(dim(df)[1], "mutations"))
ggsave(paste(wd, "/output/VAF_total_FFPE_tumor_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_FFPE_tumor %>% dplyr::filter(msec_filter_1234)
g = ggplot(data=df, aes(x=`%Alt`)) +
  xlab("Variant allele frequency (%)") +
  ylab("Mutations") +
  ggtitle("Filtered out mutations (tumor, FFPE)") +
  geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black") + 
  theme(legend.position="right")
g = g + ylim(0,120)
g = g + theme_set(theme_bw(base_size = 25))
g = g + scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
g = g + annotate("text", x=80, y=120, size = 12, label=paste(dim(df)[1], "mutations"))
ggsave(paste(wd, "/output/VAF_filtered_FFPE_tumor_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)


```

# Figure mutation depth in FFPE normal samples
```{r, eval=FALSE}
msec_result = df_filter %>% dplyr::filter(Sample %in% df_FFPE_normal$Sample)
# 10,,,,100
# locally weighted scatter plot smooth curve
Total_count = rep(0,91)
Passed_count = rep(0,91)
Filtered_rate = rep(0,91)
for(i in 1:91){
  Total_count[i] = dim(msec_result %>% dplyr::filter(total_read == (10 + i)))[1]
  Passed_count[i] = dim(msec_result %>% dplyr::filter(total_read == (10 + i) & !msec_filter_1234))[1]
  Filtered_rate[i] = 1 - fun_zero(Passed_count[i], Total_count[i])
}

second_rate = 55 / 110

df = data.frame(
    threshold  = 10:100,
    Total_count = Total_count,
    Passed_count = Passed_count,
    Filtered_rate = Filtered_rate * second_rate * 100
)

g = ggplot(data=df) +
  xlab("Mutation depth") +
  ylab("Mutations") +
  ggtitle("Mutation filtering rate") +
  scale_x_continuous(breaks=seq(0,101,10)) +
  scale_y_continuous(breaks=seq(0,55,10), limits=c(0,55), sec.axis = sec_axis(~ . / second_rate, name = "Filtering rate (%)", breaks = seq(0,110,20))) +
  geom_bar(aes(x=threshold, y=Total_count),
           stat="identity", position="identity", 
           alpha=0.2) + 
  geom_bar(aes(x=threshold,y=Passed_count),
            stat="identity", position="identity",
            fill="blue", colour="white", alpha=0.6) +
  geom_line(aes(x=threshold,y=Filtered_rate), 
             stat="identity",
             position="identity",
             colour="black") +
  geom_smooth(aes(x=threshold,y=Filtered_rate),
              method = "loess",
              se = FALSE,
              colour="red")
#  theme(legend.position="right")
#g = g + geom_vline(xintercept=10, linetype="dashed", colour="red")
g = g + theme_set(theme_bw(base_size = 25))
ggsave(paste(wd, "/output/Filtered_rate_", Sys.Date(), ".pdf", sep=""), plot=g, width=20, height=16)

```

# Figure Q18 rate
```{r, eval=FALSE}
df = df_filter_FFPE_normal
g = ggplot(df, aes(x = low_quality_base_rate_under_q18 * 100))
g = g + geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black")
g = g + theme_set(theme_bw(base_size = 25))
g = g + xlab("Rate of low-quality bases (%)")
g = g + ylab("Mutations")
g = g + ylim(0,2500)
g = g + geom_vline(xintercept=10, linetype="dashed", colour="red")
g = g + ggtitle("FFPE samples of normal breast tissue")
g = g +scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
ggsave(paste(wd, "/output/low_quality_base_rate_under_q18_FFPE_normal_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_frozen_tumor
g = ggplot(df, aes(x = low_quality_base_rate_under_q18 * 100))
g = g + geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black")
g = g + theme_set(theme_bw(base_size = 25))
g = g + xlab("Rate of low-quality bases (%)")
g = g + ylab("Mutations")
g = g + ylim(0,100)
g = g + geom_vline(xintercept=10, linetype="dashed", colour="red")
g = g + ggtitle("Frozen samples of breast tumor")
g = g +scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
ggsave(paste(wd, "/output/low_quality_base_rate_under_q18_frozen_tumor_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)
```

# Figure Soft clip rate
```{r, eval=FALSE}
df = df_filter_FFPE_normal
g = ggplot(df, aes(x = soft_clipped_read / total_read * 100))
g = g + geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black")
g = g + theme_set(theme_bw(base_size = 25))
g = g + xlab("Rate of soft-clipped reads (%)")
g = g + ylab("Mutations")
g = g + ylim(0,125)
#g = g + geom_vline(xintercept=90, linetype="dashed", colour="red")
g = g + ggtitle("FFPE samples of normal breast tissue")
g = g +scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
ggsave(paste(wd, "/output/soft_clip_rate_FFPE_normal_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_frozen_tumor
g = ggplot(df, aes(x = soft_clipped_read / total_read * 100))
g = g + geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black")
g = g + theme_set(theme_bw(base_size = 25))
g = g + xlab("Rate of soft-clipped reads (%)")
g = g + ylab("Mutations")
g = g + ylim(0,30)
#g = g + geom_vline(xintercept=90, linetype="dashed", colour="red")
g = g + ggtitle("Frozen samples of breast tumor")
g = g +scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
ggsave(paste(wd, "/output/soft_clip_rate_frozen_tumor_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)
```

# Figure hairpin rate
```{r, eval=FALSE}
df = df_filter_FFPE_normal
g = ggplot(df, aes(x = flag_hairpin / total_read * 100))
g = g + geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black")
g = g + theme_set(theme_bw(base_size = 25))
g = g + xlab("Rate of reads derived from the hairpin structure (%)")
g = g + ylab("Mutations")
g = g + ylim(0,2000)
g = g + geom_vline(xintercept=50, linetype="dashed", colour="red")
g = g + ggtitle("FFPE samples of normal breast tissue.")
g = g +scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
ggsave(paste(wd, "/output/hairpin_rate_FFPE_normal_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_frozen_tumor
g = ggplot(df, aes(x = flag_hairpin / total_read * 100))
g = g + geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black")
g = g + theme_set(theme_bw(base_size = 25))
g = g + xlab("Rate of reads derived from the hairpin structure (%)")
g = g + ylab("Mutations")
g = g + ylim(0,100)
g = g + geom_vline(xintercept=50, linetype="dashed", colour="red")
g = g + ggtitle("Frozen samples of breast tumor.")
g = g +scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
ggsave(paste(wd, "/output/hairpin_rate_frozen_tumor_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)
```

# Figure homologous region rate
```{r, eval=FALSE}
df = df_filter_FFPE_normal
g = ggplot(df, aes(x = distant_homology_rate * 100))
g = g + geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black")
g = g + theme_set(theme_bw(base_size = 25))
g = g + xlab("Rate of reads derived from homologous regions (%)")
g = g + ylab("Mutations")
g = g + ylim(0,1250)
g = g + geom_vline(xintercept=15, linetype="dashed", colour="red")
g = g + ggtitle("FFPE samples of normal breast tissue")
g = g +scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
ggsave(paste(wd, "/output/distant_homology_rate_FFPE_normal_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)

df = df_filter_frozen_tumor
g = ggplot(df, aes(x = distant_homology_rate * 100))
g = g + geom_histogram(binwidth=2.5, boundary=0, fill = "grey", color = "black")
g = g + theme_set(theme_bw(base_size = 25))
g = g + xlab("Rate of reads derived from homologous regions (%)")
g = g + ylab("Mutations")
g = g + ylim(0,100)
g = g + geom_vline(xintercept=15, linetype="dashed", colour="red")
g = g + ggtitle("Frozen samples of breast tumor")
g = g +scale_x_continuous(breaks=seq(0,100,by=20),limits=c(0,100))
ggsave(paste(wd, "/output/distant_homology_rate_frozen_tumor_", Sys.Date(), ".pdf", sep=""), plot=g, width=10, height=8)
```

# Sensitivity and specificity analysis
```{r}
dat <- as.table(matrix(c(28,3,1,65), nrow = 2, byrow = TRUE))
colnames(dat) <- c("True mutation","Artifact")
rownames(dat) <- c("Filter passed","Filtered out")
rval <- epi.tests(dat, conf.level = 0.95)
print(rval); summary(rval)

```

## Information about the current R session
```{r, eval=FALSE}
sessionInfo()
```
